##############################################
# NETLIFY BUILD CONFIG
##############################################
[build]
  command = "next build"
  publish = ".next"
  node_version = "20"

##############################################
# NEXT.JS APP ROUTER SUPPORT
##############################################
[[plugins]]
package = "@netlify/plugin-nextjs"

  # Plugin settings must go under "inputs", not config
  [plugins.inputs]
  disableEdgeFunctions = true

##############################################
# SERVERLESS FUNCTION CONFIG
##############################################
[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"
  external_node_modules = ["@neondatabase/serverless"]

##############################################
# FORCE ALL API ROUTES THROUGH NEXT
##############################################
# This ensures PUT / DELETE / PATCH are forwarded
# correctly to Next.js App Router.
##############################################
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/next_api"
  status = 200
  force = true

##############################################
# CUSTOM REDIRECTS
##############################################

[[redirects]]
  from = "/player"
  to = "/"
  status = 200

[[redirects]]
  from = "/campaign-manager"
  to = "/"
  status = 200

[[redirects]]
  from = "/search"
  to = "/"
  status = 200
